<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pilotage RIP - Outil de planification des ressources</title>
  <meta name="description" content="Outil de pilotage et planification des ressources RIP">
  <link rel="stylesheet" href="styles.css">
  
  <!-- Scripts des modules avec chargement différé -->
  <script defer src="time-utils.js"></script>
  <script defer src="import-export.js"></script>
  <script defer src="availability.js"></script>
  <script defer src="calendar.js"></script>
  <script defer src="preparateurs.js"></script>
  <script defer src="planning-logic.js"></script>
  <script defer src="planning-display.js"></script>
  <script defer src="resources-filter.js"></script>
  <script defer src="chantiers.js"></script>
  <script defer src="chantier-creation.js"></script>
  <script defer src="main.js"></script>
</head>

<body>
  <!-- Navigation principale -->
  <nav class="sidebar" role="navigation" aria-label="Menu principal">
    <div class="logo">
      <img src="https://myexploit.place-cloud-enedis.fr/asset/img/favicon.ico" 
           alt="Logo Enedis" 
           width="40" 
           height="40">
    </div>
    
    <!-- Boutons d'action -->
    <button data-action="reload-api" 
            aria-label="Recharger depuis l'API" 
            title="Recharger les données depuis l'API">
      🔄
    </button>
    
    <button data-action="import" 
            aria-label="Importer des données" 
            title="Importer un fichier JSON">
      📂
    </button>
    
    <button data-action="export" 
            aria-label="Exporter les données" 
            title="Télécharger les données en JSON">
      💾
    </button>
    
    <button data-action="manage-prep" 
            aria-label="Gérer les préparateurs" 
            title="Ajouter, modifier ou supprimer des préparateurs">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="#12938e" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5z"/>
        <path d="M2 22v-2c0-3.3 6.7-5 10-5s10 1.7 10 5v2H2z"/>
      </svg>
    </button>
    
    <button id="edit-availability-btn" 
            aria-label="Éditer les disponibilités" 
            title="Modifier les disponibilités des préparateurs">
      📅
    </button>
    
    <button id="open-chantier-btn" 
            aria-label="Gérer les chantiers" 
            title="Consulter et modifier les chantiers">
      ✏️
    </button>
    
    <button id="creation_chantier" 
            aria-label="Créer un chantier" 
            title="Créer et affecter un nouveau chantier">
      🛠️
    </button>

    <!-- Contrôle d'affichage -->
    <div class="vertical-slider-container" data-value="10">
      <label for="visible-weeks" class="sr-only">Nombre de semaines affichées</label>
      <input type="range" 
             id="visible-weeks" 
             min="1" 
             max="20" 
             value="10" 
             aria-label="Ajuster le nombre de semaines visibles"
             title="Nombre de semaines à afficher">
    </div>
    
    <!-- Input file caché -->
    <input type="file" 
           id="importFile" 
           accept="application/json" 
           style="display:none" 
           aria-label="Fichier JSON à importer" />
  </nav>

  <!-- Contenu principal -->
  <main class="content" role="main">
    <!-- Navigation des semaines -->
    <header class="header" id="week-nav" role="banner" aria-label="Navigation des semaines"></header>
    
    <!-- Grille de planification -->
    <section class="planning-container" role="grid" aria-label="Grille de planification des ressources">
      <!-- En-tête fixe des semaines -->
      <div class="grid-header" id="grid-header" role="row"></div>
      <!-- Contenu défilable -->
      <div class="grid-content" id="schedule-grid" role="grid">
        <div class="week-row" id="fixed-week-row" role="row"></div>
      </div>
    </section>
  </main>

  <!-- Modales et overlays -->
  
  <!-- Filtre des ressources -->
  <div id="resourcesFilterOverlay" role="dialog" aria-label="Filtre des ressources" aria-hidden="true">
    <div class="filter-content">
      <h4>Filtrer les ressources</h4>
      <div class="filter-input-container">
        <input type="text" 
               id="resourcesFilterInput" 
               placeholder="Rechercher un préparateur..."
               autocomplete="off">
        <div id="resourcesSuggestions" class="suggestions-dropdown"></div>
      </div>
      <div id="selectedResources" class="selected-chips"></div>
      <div class="filter-actions">
        <button id="clearResourcesFilter">Effacer tout</button>
        <button id="applyResourcesFilter">Appliquer</button>
        <button id="closeResourcesFilter">Fermer</button>
      </div>
    </div>
  </div>
  
  <!-- Calendrier de navigation -->
  <div id="calendarOverlay" role="dialog" aria-label="Sélecteur de calendrier" aria-hidden="true"></div>

  <!-- Interface de gestion des préparateurs -->
  <div id="prepOverlay" role="dialog" aria-labelledby="prep-title" aria-hidden="true">
    <h3 id="prep-title">Gérer les préparateurs</h3>
    <div id="prepList" role="list" aria-label="Liste des préparateurs"></div>
    <div id="prepControls">
      <button id="btnShowAdd" data-action="show-add-form">Ajouter un préparateur</button>
    </div>
    <form id="addForm" aria-label="Formulaire d'ajout de préparateur">
      <label for="prepName" class="sr-only">Nom du préparateur</label>
      <input id="prepName" 
             placeholder="Nom du préparateur" 
             required 
             aria-describedby="prep-name-help" />
      <div id="prep-name-help" class="sr-only">Saisissez le nom complet du préparateur</div>
      
      <label for="prepNNI" class="sr-only">NNI du préparateur</label>
      <input id="prepNNI" 
             placeholder="NNI" 
             required 
             aria-describedby="prep-nni-help" />
      <div id="prep-nni-help" class="sr-only">Saisissez le numéro NNI du préparateur</div>
      
      <div role="group" aria-label="Actions du formulaire">
        <button type="submit" data-action="add-preparateur">Valider</button>
        <button type="button" class="cancel" data-action="hide-add-form">Annuler</button>
      </div>
    </form>
    <div style="text-align:right;">
      <button data-action="close-prep-overlay">Fermer</button>
    </div>
  </div>

</body>
</html>
